
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ongo the Art Collector</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" href="{{ url_for('static', filename='ongo.ico') }}" type="image/x-icon">
</head>
<body class="bg-light">
  <div class="container py-5">

    <!-- Logo + Heading -->
    <div class="d-flex align-items-center justify-content-center mb-4">
      <img src="{{ url_for('static', filename='ongo.png') }}" alt="Ongo Logo" class="me-3" style="max-width: 18%; padding-right: 2%;">
      <div style="text-align: center;">
        <h1 class="display-5 fw-bold m-0">Ongo the Art Collector</h1>
        <p class="lead m-0">Upload your masterpiece. Ongo will decide its fate.</p>
      </div>
    </div>


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ongo the Art Collector</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" href="{{ url_for('static', filename='ongo.ico') }}" type="image/x-icon">

<style>
  .sample-thumb {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border-radius: 6px;
  }

  .sample-thumb:hover {
    transform: scale(1.08);
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  }
</style>

</head>
<body class="bg-light">
  



    <!-- Sample Gallery -->
    <div class="text-center mb-5">
      <h5 class="mb-2">üé® Sample Artworks</h5>
      <div class="d-flex flex-wrap justify-content-center gap-3">
        <img src="{{ url_for('static', filename='samples/toilet.jpg') }}" class="sample-thumb" data-src="toilet.jpg" alt="Toilet" style="cursor:pointer; max-height:100px;">
        <img src="{{ url_for('static', filename='samples/dumpster_fire.png') }}" class="sample-thumb" data-src="dumpster_fire.png" alt="Dumpster Fire" style="cursor:pointer; max-height:100px;">
        <img src="{{ url_for('static', filename='samples/banana.jpg') }}" class="sample-thumb" data-src="banana.jpg" alt="Banana Taped to Wall" style="cursor:pointer; max-height:100px;">
        <img src="{{ url_for('static', filename='samples/grasp.jpg') }}" class="sample-thumb" data-src="grasp.jpg" alt="The Grasp" style="cursor:pointer; max-height:100px;">
        <img src="{{ url_for('static', filename='samples/starry_night.png') }}" class="sample-thumb" data-src="starry_night.png" alt="Starry Night" style="cursor:pointer; max-height:100px;">
      </div>
    </div>

    <!-- [rest of the HTML stays unchanged] -->

</body>
</html>
<div class="container py-5">

    <!-- Upload Form -->
    <form id="artForm" enctype="multipart/form-data" class="card p-4 shadow-sm">
      <div class="mb-3">
        <label for="image" class="form-label"><b>Upload Artwork</b></label>
        <input class="form-control" type="file" name="image" id="image" required>
      </div>
      <div class="d-flex align-items-center justify-content-center mb-4">
        <button type="submit" class="btn btn-dark w-100" style="max-width: 75%;">Summon Ongo</button>
      </div>
    </form>

    <!-- Uploaded Image Preview -->
    <div id="uploadedImageContainer" class="text-center mt-4 d-none">
      <p class="fw-light">Uploaded Image:</p>
      <img id="uploadedImage" class="img-thumbnail" style="max-width: 300px;">
    </div>

    <!-- Critique Output -->
    <div id="critiqueBlock" class="mt-5 d-none">
      <h3 class="text-center mb-3">üóØÔ∏è Ongo Says:</h3>
      <div id="critiqueText" class="alert alert-secondary p-4 fs-5 shadow-sm" style="white-space: pre-wrap;"></div>
    </div>

<p class="text-center mt-4">üéôÔ∏è Hear the Critique</p>
    <div class="text-center text-muted small mt-2">
        üîä Realistic speech engine powered by <a href="https://www.elevenlabs.io" target="_blank">ElevenLabs</a>
      </div>

    <!-- Audio Player -->
    <div id="audioBlock" class="text-center mt-4 d-none">

      
      <audio id="audioPlayer" controls>
        <source src="/static/audio/output.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
  
    </div>

    <!-- Buy Me a Coffee -->
    <div class="text-center mt-5">
      <a href="https://buymeacoffee.com/blakebrandon" target="_blank">
        <button class="btn btn-warning btn-lg">
          ‚òï Buy Ongo a Coffee
        </button>
      </a>
      <div class="mt-2">
        <small class="text-muted">Hosting ML models is expensive ‚Äî caffeine helps.</small>
      </div>
    </div>

  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App Logic -->
  <script>
  document.getElementById("artForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);
    const submitBtn = form.querySelector("button");
    submitBtn.disabled = true;
    submitBtn.textContent = "Ongo is judging...";

    const imageInput = document.getElementById("image");
    const uploadedImage = document.getElementById("uploadedImage");
    const imageUrl = URL.createObjectURL(imageInput.files[0]);
    uploadedImage.src = imageUrl;
    document.getElementById("uploadedImageContainer").classList.remove("d-none");

    const critiqueText = document.getElementById("critiqueText");
    critiqueText.textContent = "";
    document.getElementById("critiqueBlock").classList.remove("d-none");

    try {
      const response = await fetch("/critique", {
        method: "POST",
        body: formData
      });

      if (!response.ok) throw new Error("Stream failed");

      const reader = response.body.getReader();
      const decoder = new TextDecoder("utf-8");
      let buffer = "";

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        buffer += decoder.decode(value, { stream: true });
        const lines = buffer.split("\n");
        buffer = lines.pop();

        for (const line of lines) {
          if (!line.trim()) continue;
          const data = JSON.parse(line);

          if (data.type === "text") {
            critiqueText.textContent += data.content;
          } else if (data.type === "audio") {
            const audioBlock = document.getElementById("audioBlock");
            const audioPlayer = document.getElementById("audioPlayer");
            const audioSource = audioPlayer.querySelector("source");

            audioSource.src = data.url + "?t=" + Date.now();
            audioPlayer.load();
            audioBlock.classList.remove("d-none");

            audioPlayer.play().catch(err => {
              console.warn("Autoplay blocked:", err);
            });
          }
        }
      }
    } catch (err) {
      console.error(err);
      alert("Something went wrong while summoning Ongo.");
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = "Summon Ongo";
    }
  });

  document.querySelectorAll(".sample-thumb").forEach(thumb => {
    thumb.addEventListener("click", async () => {
      const imageName = thumb.getAttribute("data-src");
      const response = await fetch(`/static/samples/${imageName}`);
      const blob = await response.blob();

      const extension = blob.type === "image/png" ? ".png" : ".jpeg";
      const filename = imageName;


      const file = new File([blob], filename, { type: blob.type });
      const formData = new FormData();
      formData.append("image", file);

      const submitBtn = document.querySelector("#artForm button");
      submitBtn.disabled = true;
      submitBtn.textContent = "Summoning Ongo...";

      const critiqueText = document.getElementById("critiqueText");
      critiqueText.textContent = "";
      document.getElementById("critiqueBlock").classList.remove("d-none");

      if (window.previousPreviewUrl) {
        URL.revokeObjectURL(window.previousPreviewUrl);
      }

      const imageUrl = URL.createObjectURL(file);
      window.previousPreviewUrl = imageUrl;

      const uploadedImage = document.getElementById("uploadedImage");
      uploadedImage.src = imageUrl;
      document.getElementById("uploadedImageContainer").classList.remove("d-none");

      try {
        const response2 = await fetch("/critique", {
          method: "POST",
          body: formData
        });

        if (!response2.ok) throw new Error("Stream failed");

        const reader = response2.body.getReader();
        const decoder = new TextDecoder("utf-8");
        let buffer = "";

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;

          buffer += decoder.decode(value, { stream: true });
          const lines = buffer.split("\n");
          buffer = lines.pop();

          for (const line of lines) {
            if (!line.trim()) continue;
            const data = JSON.parse(line);

            if (data.type === "text") {
              critiqueText.textContent += data.content;
            } else if (data.type === "audio") {
              const audioBlock = document.getElementById("audioBlock");
              const audioPlayer = document.getElementById("audioPlayer");
              const audioSource = audioPlayer.querySelector("source");

              audioSource.src = data.url + "?t=" + Date.now();
              audioPlayer.load();
              audioBlock.classList.remove("d-none");

              audioPlayer.play().catch(err => {
                console.warn("Autoplay blocked:", err);
              });
            }
          }
        }

      } catch (err) {
        console.error(err);
        alert("Something went wrong while summoning Ongo.");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Summon Ongo";
      }
    });
  });
</script>


</body>
</html>
